import{c as i}from"./broker-factory-BwvfpcaN.js";import{a as o}from"./fast-unique-numbers-DPbHlSK3.js";const a=new Set,c=new Set,s=new WeakMap,w=i({deregister:({call:t})=>async e=>{const r=s.get(e);if(r===void 0)throw new Error("There is no encoder registered with the given port.");const n=await t("deregister",{encoderId:r});return a.delete(r),s.delete(e),n},encode:({call:t})=>async(e,r)=>{const n=await t("encode",{encoderInstanceId:e,timeslice:r});return c.delete(e),n},instantiate:({call:t})=>async(e,r)=>{const n=o(c),d=await t("instantiate",{encoderInstanceId:n,mimeType:e,sampleRate:r});return{encoderInstanceId:n,port:d}},register:({call:t})=>async e=>{if(s.has(e))throw new Error("");const r=o(a);s.set(e,r);try{return await t("register",{encoderId:r,port:e},[e])}catch(n){throw a.delete(r),s.delete(e),n}}}),h=t=>{const e=new Worker(t);return w(e)};export{h as l};
//# sourceMappingURL=media-encoder-host-broker-DZztKf8z.js.map
